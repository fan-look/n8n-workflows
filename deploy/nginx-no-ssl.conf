# Nginx (no SSL) reverse proxy for n8n-workflows
# Use in internal/test environments or behind an external TLS terminator.
# Simple configuration: proxy all traffic to Node at 127.0.0.1:3000

server {
  listen 80;
  server_name n8n.bingotech2022.com;

  # Logs & limits
  client_max_body_size 20M;
  access_log /var/log/nginx/n8n_no_ssl_access.log;
  error_log  /var/log/nginx/n8n_no_ssl_error.log warn;

  # Security headers (basic)
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Referrer-Policy "no-referrer-when-downgrade" always;
  add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

  # Proxy settings
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_read_timeout 60s;
  proxy_send_timeout 60s;
  proxy_connect_timeout 5s;

  # Proxy entire site to backend (recommended for simplicity)
  location / {
    proxy_pass http://127.0.0.1:3000;
  }

  # Explicit API and health paths (optional; handled by above rule as well)
  location /api/ {
    proxy_pass http://127.0.0.1:3000;
  }

  location /health {
    proxy_pass http://127.0.0.1:3000/health;
  }

  # Optional: serve static directly from Nginx (uncomment and set correct path)
  # set $STATIC_ROOT "/var/www/n8n-workflows/dist/static";
  # location /static/ {
  #   root $STATIC_ROOT;
  #   try_files $uri @backend_static;
  #   expires 7d;
  #   add_header Cache-Control "public, max-age=604800";
  #   add_header Vary "Accept-Encoding";
  # }
  # location @backend_static {
  #   proxy_pass http://127.0.0.1:3000;
  # }
}